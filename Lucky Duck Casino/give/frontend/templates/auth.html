<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Авторизация</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/static/css/styles_index.css" />
    <link rel="stylesheet" href="/static/css/styles_auth.css" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Roboto:wght@400;700&display=swap');
    </style>
</head>
<body class="flex flex-col min-h-screen bg-gray-900 text-white">
     <!-- Animated Background Elements -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none">
        <div class="absolute top-10 left-1/4 w-16 h-16 rounded-full bg-yellow-500 opacity-20 blur-xl"></div>
        <div class="absolute top-1/3 right-1/5 w-24 h-24 rounded-full bg-red-500 opacity-20 blur-xl"></div>
        <div class="absolute bottom-1/4 left-1/5 w-20 h-20 rounded-full bg-green-500 opacity-20 blur-xl"></div>
        <div class="absolute bottom-10 right-1/4 w-12 h-12 rounded-full bg-blue-500 opacity-20 blur-xl"></div>
    </div>

    <!-- Header -->
    <header class="relative z-10 py-6 px-4 sm:px-6 lg:px-8">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fas fa-dice text-3xl text-yellow-400"></i>
                <h1 class="text-2xl sm:text-3xl font-bold text-white">Lucky Duck Casino</h1>
            </div>
        </div>
    </header>

    <div class="form-container">
        <h2 id="form-title">Вход</h2>
        <!-- <div id="error-message" style="display: none; color: red; margin-bottom: 10px;"></div>
          -->
        <div id="error-message" class="error-message" style="display: none;"></div>
        <form id="auth-form">
            <div>
                <input type="text" id="username" placeholder="Имя пользователя" required>
            </div>
            <div>
                <input type="password" id="password" placeholder="Пароль" required>
            </div>
            <button type="submit" id="submit-button">Войти</button>
        </form>
        
        <div class="toggle-link" id="toggle-link">Нет аккаунта? Зарегистрируйтесь</div>
    </div>
     <!-- Footer -->
    <footer class="relative z-10 py-6 px-4 sm:px-6 lg:px-8 bg-opacity-20 mt-12">
        <div class="container mx-auto">
            <div class="flex flex-col items-center">
                <div class="flex items-center space-x-2 mb-2">
                    <i class="fas fa-dice text-xl text-yellow-400"></i>
                    <span class="text-white">Lucky Duck Casino</span>
                </div>
                <div class="text-gray-400 text-sm text-center">
                    <p>© 2025 Lucky Duck Casino. All rights reserved.</p>
                </div>
            </div>
        </div>
    </footer>
    <script src="/static/js/api_auth.js"></script>
    <script>

        const authForm = document.getElementById('auth-form');
        const formTitle = document.getElementById('form-title');
        const toggleLink = document.getElementById('toggle-link');
        const submitButton = document.getElementById('submit-button');
        const errorMessage = document.getElementById('error-message');

        let isLogin = true; // Переменная для отслеживания состояния формы

        toggleLink.addEventListener('click', () => {
            isLogin = !isLogin; // Переключаем состояние
            if (isLogin) {
                formTitle.textContent = 'Вход';
                submitButton.textContent = 'Войти';
                toggleLink.textContent = 'Нет аккаунта? Зарегистрируйтесь';
                errorMessage.style.display = 'none';
                errorMessage.textContent = '';
            } else {
                formTitle.textContent = 'Регистрация';
                submitButton.textContent = 'Зарегистрироваться';
                toggleLink.textContent = 'Уже есть аккаунт? Войдите';
                errorMessage.style.display = 'none';
                errorMessage.textContent = '';
            }
        });

        authForm.addEventListener('submit', async (event) => {
            event.preventDefault();

            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            errorMessage.style.display = 'none';
            errorMessage.textContent = '';

            const endpoint = isLogin ? '/api/log_in' : '/api/sign_in';
            authenticate(endpoint, username, password).then(response => {
                console.log('Статус код:', response.statusCode);
                console.log('Ответ от сервера:', response.data);

                if (response.statusCode === 200) {
                    window.location.href = '/blackjack'; 
                } else {
                    errorMessage.textContent = response.data.msg || 'Ошибка при авторизации';
                    errorMessage.style.display = 'block';
                }
            }).catch(error => {
                console.error('Ошибка:', error);
                errorMessage.textContent = 'Произошла ошибка при отправке запроса';
                errorMessage.style.display = 'block';
            });
        });
    </script>
</body>
</html>